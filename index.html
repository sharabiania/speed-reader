<!DOCTYPE html>

<html>
    <head>
        <style>
            /*** a-Theme ***/
            *{box-sizing: border-box;}
            *:focus {outline: 0;}
            html, body {height: 100%;}            
            body {font-family: "Open Sans","Calibri","sans-serif";background-color:wheat;margin: 1%;text-align: center;}
            button {background-color: whitesmoke; cursor: pointer; margin:5px;padding: 10px;border-style: double; border-color:#cccccc;text-transform: capitalize;}        
            button:hover{border-color:#aaaaaa;}                                 
            ::selection{background-color: darkslategray;color:aliceblue;}
            ::-webkit-scrollbar{width:8px;cursor: -webkit-grab;}     
            ::-webkit-scrollbar-track:hover{background: #eeeeee;cursor: pointer;}
            ::-webkit-scrollbar-thumb {border-radius: 10px;background: #cccccc;}
            /*** END a-Theme ***/
            
            #a-screen{display: table;background-color: lightgrey;  margin: auto; width: 100%; height: 70%}
            #a-text {display:table-cell; vertical-align: middle; margin:auto;
             width: 100%; height: 100%; line-height: 100%; 
             font-size:40px;
             font-family: sans-serif;
             }
             #a-progress {width: 100%;}             
             #a-slider:hover {background-color: darkgray;cursor: pointer;}
             #a-label{font-size: 14px; font-style: italic;}
             #a-label::after{content: " words per minute"}
             #a-input {width: 40%;resize: none;}
             .a-btn-play::after{content: "read";}
             .a-btn-pause {background-color:#cccccc;}
             .a-btn-pause::after{content: "pause";}
             .a-container {width: 40%; height:60%;min-height: max-content;background-color: lightgray;margin: auto;}
             .a-flex {display: flex;padding: 5px;}
             .a-flex > div {flex-grow: 0; flex-basis: 33%;}
             .a-flex > div:last-child {text-align: right;}
             .a-flex > div:first-child {text-align: left;}
        </style>
    </head>
    <body>
        <div class="a-container">
            <div id="a-screen">
                <div id="a-text">Push the button!</div>
            </div>       
            <progress id="a-progress" value="0" max="100"></progress>
            <br/><hr>
            <div class="a-flex">
                <div><button onclick="reset()">Reset</button></div>
                <div>
                    <input id="a-slider" type="range" min="200" max="700" value="400" step="50" onchange="changeDelay(this)"/>
                    <br/>
                    <label id="a-label" for="a-slider">400</label>
                </div>
                <div><button id="a-play"  class="a-btn-play"></button></div>                
            </div>
        </div>
        <textarea id="a-input" rows="8"></textarea>
        <script>
            var div  = document.getElementById("a-text");
            document.getElementById("a-input").value = 
            "Paste some text that you want to speed read, then press \"Read\" button."
            +"\nYou can change the speed using the slider, or pause at any time.";

            function sleep(miliseconds) {
                var currentTime = new Date().getTime();

                while (currentTime + miliseconds < new Date().getTime()) {}
            }

            var s = 0;

            function changeDelay(el) {
                document.getElementById('a-label').innerText = el.value;
                s = Math.floor((60 / el.value) * 1000);
                
            }
            var pause = true;
           
            var i= 0;
            function run() {
                var progress = document.getElementById("a-progress");
                document.getElementById("a-slider").onchange();
                this.classList.toggle("a-btn-play");
                this.classList.toggle("a-btn-pause");
                var element = this;
                pause = !pause;

                var text = document.getElementById("a-input").value;              
                var words = text.match(/\b(\w+\W+)/g);
              
                
                (function loop(){
                    div.innerText = "";
                    div.innerText = words[i];
                    progress.value = (i / words.length) * 100; 
                    if(pause === false)
                    {                                          
                        if(++i < words.length){
                            setTimeout(loop, s, i);
                        }
                        else {
                            i = 0; 
                            element.className = "a-btn-play";
                            progress.value = 100;
                            pause = true;
                        }
                        
                    }
                })();
              
            }

            function reset() {
                // TODO use two-way binding...
                i = 0;
                document.getElementById("a-progress").value = 0;
            }

            document.getElementById("a-play").addEventListener('click', run);
        </script>
    </body>

</html>